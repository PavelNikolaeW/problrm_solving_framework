{% extends 'base.html' %}
{% load static %}
{% block content %}
  <div class="container" x-data="$store.chat.data()">
    <div class="row my-3">
      <!-- Секция чатов -->
      <div class="col-12 col-md-4">
        <div class="mb-3">
          <input type="text" class="form-control" placeholder="Имя пользователя или бота" x-model="newChatName">
          <button class="btn btn-primary mt-2" @click="createChat(newChatName)">Создать чат</button>
        </div>
        <div class="list-group">
          <template x-for="chat in chats" :key="chat.id">
            <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
               @click="selectChat(chat)">
              <span x-text="chat.name"></span>
              <span class="badge bg-primary rounded-pill" x-text="chat.messages.length"></span>
            </a>
          </template>
        </div>
      </div>
      <!-- Секция сообщений -->
      <div class="col-12 col-md-8">
        <div class="chat-messages bg-light border rounded" style="height: 400px; overflow-y: scroll;">
          <template x-if="selectedChat">
            <template x-for="message in selectedChat.messages" :key="message.id">
              {#  todo впилить аву сюда             #}
              <div class="p-2 message-item border-bottom d-flex justify-content-between">
                <p class="mb-1 " x-text="message.content"></p>
                <div class="message-actions d-flex nowrap align-self-end" style="opacity: .5">
                  <button class="btn btn-sm" @click="editMessage(message)"><i
                      class="message-actions bi bi-pencil-square"></i></button>
                  <button class="btn btn-sm" @click="deleteMessage(message)"><i class="message-actions bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </template>
          </template>
          <template x-if="!selectedChat">
            <div class="p-2 text-center text-muted">
              Выберите чат для начала общения
            </div>
          </template>
        </div>
        <div class="mt-3" x-show="selectedChat">
          <input type="text" class="form-control" placeholder="Сообщение" x-model="newMessage">
          <button class="btn btn-primary mt-2" @click="sendMessage()">Отправить</button>
        </div>
      </div>
    </div>
  </div>

<script type="text/javascript" src="{% static 'js/chat/chat.js' %}"></script>
{% endblock %}

